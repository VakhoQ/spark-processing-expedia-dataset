package task3

/*
 * This Scala Testsuite was generated by the Gradle 'init' task.
 */
import java.io.File

import helper.FileFormat
import org.apache.spark.sql.{Encoders, SparkSession}
import org.junit.runner.RunWith
import org.scalatest.FunSuite
import org.scalatest.junit.JUnitRunner
import schema.Booking

import scala.io.Source



@RunWith(classOf[JUnitRunner])
class Top3NotBookedHotelTest extends FunSuite {

  test("top 3 not booked hotel test") {

    val spark = SparkSession
      .builder()
      .appName("Top 3 Booked").master("local[4]")
      .getOrCreate()

    val schema = Encoders.product[Booking].schema

    val input: String = "/home/vq/IdeaProjects/scala-first/src/main/resources/train.csv";
    val output: String = "/home/vq/spark/task5"


    def top3 = new Top3NotBooked()
    top3.findTop3Hotel(spark, schema, input,output, FileFormat.CSV , true)


    val dir = new File(output)
    val newFileRgex =  ".*part-00000.*\\.csv"
    val csv  = dir.listFiles.filter(_.toPath.toString.matches(newFileRgex))(0).toString

    println("FINISH")

    val lines = Source.fromFile(csv)
      .getLines
      .map(m=>m.split(","))
      .toList



    assert(true)


    /*


    +------------+-----+
    |hotel_market|count|
    +------------+-----+
    |          33|    3|
    |         000|    1|
    +------------+-----+

     */

  }
}
